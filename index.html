<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>MyRecorder</title>
  <style>
    :root{
      --bg:#121212;--surface:#1e1e1e;--surface-2:#262626;
      --primary:#4f8cff;--primary-h:#3d6fd6;--danger:#e04f4f;
      --font:#e0e0e0;--font-soft:#b0b0b0;--radius:8px;
    }
    *{box-sizing:border-box;margin:0;padding:0}

    /* global */
    body{
      background:var(--bg);
      color:var(--font);
      font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      padding:0 2rem 4rem;
    }

    /* huge logo fixed in the upper-left corner */
    .logo{
      position:fixed;
      top:14px;left:14px;
      height:140px;              /* ‚Üê change size here */
      user-select:none;
      z-index:1000;
    }
    @media(max-width:600px){.logo{height:90px}}

    /* wrapper pushed down so it doesn‚Äôt hide behind logo */
    .container{
      max-width:900px;
      margin:0 auto;
      padding-top:180px;          /* ‚âà logo-height + margin */
    }

    h3{margin:2rem 0 .8rem;color:var(--font-soft);font-weight:500}

    button,select{
      padding:.55rem 1.1rem;border:none;border-radius:var(--radius);
      font-size:.9rem;font-weight:600;cursor:pointer;
      background:var(--surface-2);color:var(--font);transition:background .15s;
    }
    button:hover{background:var(--surface)}
    button.primary{background:var(--primary);color:#fff}
    button.primary:hover{background:var(--primary-h)}
    select{appearance:none}

    details{background:var(--surface);border-radius:var(--radius);padding:.5rem 1rem;margin-top:1rem}
    summary{cursor:pointer}
    ul{list-style:none}
    li{display:flex;align-items:center;gap:.6rem;margin:.4rem 0}
    .del{cursor:pointer;font-weight:700;color:var(--danger);transition:transform .15s}
    .del:hover{transform:scale(1.2)}

    video{
      width:100%;max-width:800px;
      border-radius:var(--radius);
      box-shadow:0 0 12px #000a;
      margin-top:1rem;
      display:none;
      background:#000;
    }

    #status{min-width:220px;text-align:center;font-weight:600}
    a{color:var(--primary);text-decoration:none}
    a:hover{text-decoration:underline}

    .row{display:flex;align-items:center;gap:1rem;flex-wrap:wrap}
    label{display:flex;align-items:center;gap:.4rem;font-size:.85rem;color:var(--font-soft)}
    input[type=checkbox]{accent-color:var(--primary);width:1rem;height:1rem}
  </style>
</head>
<body>

<!-- big logo -->
<img src="/logo.png" alt="My Recorder Logo" class="logo">

<div class="container">

  <!-- AUTH -->
  <button class="primary" onclick="authenticate()">üîê Login mit Google</button>
  <span id="authStatus"></span>

  <!-- ORDNER -->
  <h3>Aufnahme-Ordner</h3>
  <select id="folderSelect"></select>
  <button onclick="populateFolders()">üîÑ</button>
  <button onclick="createFolder()">‚ûï</button>
  <p id="folderHint"></p>

  <!-- DATEIEN -->
  <details><summary id="fileSummary">Aufzeichnungen</summary><ul id="fileList"></ul></details>

  <!-- AUFNAHME -->
  <h3>Aufnahme</h3>
  <div class="row">
    <button class="primary" onclick="startRecording()">‚è∫Ô∏è Start</button>
    <button onclick="stopRecording()" disabled>‚èπÔ∏è Stop</button>
    <label><input type="checkbox" id="micToggle" checked> üé§ Mikrofon aufnehmen</label>
    <div id="status"></div>
  </div>
  <video id="preview" controls playsinline muted></video>
</div>

<script>
/* ---------- Konfiguration ---------- */
const CLIENT_ID="532950765171-rfh9ide8056k8sstf06qhcm96iv92s22.apps.googleusercontent.com";
const REDIRECT ="https://my-recorder.vercel.app";
const SCOPE    ="https://www.googleapis.com/auth/drive";

/* ---------- Globale Variablen ---------- */
let accessToken, mediaRecorder, recordedChunks=[];
let displayStream, micStream, audioCtx;

/* ---------- Auth ---------- */
function authenticate(){
  location.href=`https://accounts.google.com/o/oauth2/v2/auth?client_id=${CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT)}&response_type=token&scope=${encodeURIComponent(SCOPE)}&prompt=consent`;
}
window.onload=()=>{const h=new URLSearchParams(location.hash.slice(1));if(h.has("access_token")){accessToken=h.get("access_token");document.getElementById("authStatus").textContent="‚úÖ eingeloggt";populateFolders();}};

/* ---------- Drive-Helper ---------- */
async function gapi(u){return(await fetch(u,{headers:{Authorization:`Bearer ${accessToken}`}})).json();}

/* ---------- Ordner / Liste / Delete ---------- */
async function populateFolders(){
  if(!accessToken)return;
  const sel=document.getElementById("folderSelect");sel.innerHTML="";
  const res=await gapi("https://www.googleapis.com/drive/v3/files?fields=files(id,name)&orderBy=name&q="+encodeURIComponent("mimeType='application/vnd.google-apps.folder' and trashed=false"));
  res.files?.forEach(f=>{const o=document.createElement("option");o.value=f.id;o.textContent=f.name;sel.appendChild(o);});
  loadFolderFiles();
}
async function createFolder(){
  const n=prompt("Ordnername?");if(!n)return;
  await fetch("https://www.googleapis.com/drive/v3/files",{method:"POST",headers:{Authorization:`Bearer ${accessToken}`,"Content-Type":"application/json"},body:JSON.stringify({name:n,mimeType:"application/vnd.google-apps.folder"})});
  populateFolders();
}
async function loadFolderFiles(){
  const id=document.getElementById("folderSelect").value;if(!id)return;
  const q=`'${id}' in parents and trashed=false and (mimeType contains 'video/' or name contains '.webm')`;
  const res=await gapi("https://www.googleapis.com/drive/v3/files?fields=files(id,name,modifiedTime)&orderBy=modifiedTime desc&q="+encodeURIComponent(q));
  const ul=document.getElementById("fileList");ul.innerHTML="";
  res.files?.forEach(f=>{
    const li=document.createElement("li");
    const del=document.createElement("span");del.textContent="‚úñ";del.className="del";del.onclick=_=>deleteFile(f.id,f.name);
    const a=document.createElement("a");a.href=`https://drive.google.com/file/d/${f.id}/view`;a.target="_blank";a.textContent=`${new Date(f.modifiedTime).toLocaleString()} ‚Äì ${f.name}`;
    li.append(del,a);ul.append(li);
  });
  document.getElementById("fileSummary").textContent=`Aufzeichnungen (${res.files?.length||0})`;
}
async function deleteFile(id,n){if(!confirm(`"${n}" l√∂schen?`))return;setStatus("‚è≥ L√∂schen ‚Ä¶");await fetch(`https://www.googleapis.com/drive/v3/files/${id}`,{method:"DELETE",headers:{Authorization:`Bearer ${accessToken}`} });setStatus("‚úÖ gel√∂scht");loadFolderFiles();}

/* ---------- Aufnahme ---------- */
async function startRecording(){/* unver√§ndert (aus deinem Code) */}
function stopRecording(){/* unver√§ndert */}
async function handleStop(){/* unver√§ndert */}
function toggleBtns(r){document.querySelector("button[onclick='startRecording()']").disabled=r;document.querySelector("button[onclick='stopRecording()']").disabled=!r}

/* ---------- Upload & Poll ---------- */
async function upload(blob,name){/* unver√§ndert */}
function setStatus(h){document.getElementById("status").innerHTML=h;}
</script>
</body>
</html>
